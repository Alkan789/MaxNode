name: Miysoft Hemi Node Cycle
on:
  repository_dispatch:
    types: [next_worker]
  workflow_dispatch:

jobs:
  node-engine:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: ðŸ§¹ PURGE & SETUP (Alan AÃ§ ve AraÃ§larÄ± Kur)
        run: |
          # Gereksiz dosyalarÄ± sil
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /usr/local/share/powershell /usr/share/swift /usr/local/lib/node_modules
          # Gerekli araÃ§larÄ± kur (jq eklendi)
          sudo apt-get update && sudo apt-get install -y rclone curl tar jq openssh-server
          sudo service ssh start
          df -h

      - name: ðŸš€ RUN OTONOM WORKER
        env:
          RCLONE_TOKEN_BODY: ${{ secrets.RCLONE_TOKEN_BODY }}
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
          MIYSOFT_KEY: ${{ secrets.MIYSOFT_KEY }}
          SSH_PASSWORD: ${{ secrets.SSH_PASSWORD }}
          WORKER_ID: ${{ github.event.client_payload.worker_id || 1 }}
        run: |
          chmod +x worker.sh
          ./worker.sh
